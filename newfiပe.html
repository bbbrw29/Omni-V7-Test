<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>VIP STEALTH PRO - RE-FIXED</title>
<style>
:root { --bg: #0d1117; --card: #161b22; --border: #30363d; --text: #c9d1d9; --blue: #58a6ff; --gold: #d29922; --green: #238636; --red: #f85149; }
body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 8px; margin: 0; }
.container { max-width: 420px; margin: auto; }
.panel { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 10px; margin-bottom: 8px; }

h4 { margin: 0 0 8px 0; color: var(--gold); border-bottom: 1px solid var(--border); padding-bottom: 5px; font-size: 10px; text-transform: uppercase; display: flex; justify-content: space-between; align-items: center; }

/* Pulse for Strict Trigger */
@keyframes soft-pulse {
    0% { border-color: var(--border); }
    50% { border-color: var(--red); box-shadow: 0 0 10px rgba(248, 81, 73, 0.4); }
    100% { border-color: var(--border); }
}
.signal-on { animation: soft-pulse 1.2s infinite; border-width: 1.5px !important; }

/* Live Grid & Position Labels */
.live-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
.live-card { background: #000; padding: 8px; border-radius: 10px; border: 1.5px solid var(--border); }
.live-info { display: flex; justify-content: space-between; font-size: 11px; font-weight: bold; margin-bottom: 4px; border-bottom: 1px solid #222; }
.live-dots { display: flex; gap: 2px; margin-top: 2px; }
.dot-col { display: flex; flex-direction: column; align-items: center; gap: 2px; flex: 1; }
.dot { width: 100%; height: 6px; border-radius: 1px; }
.pos-num { font-size: 7px; color: #555; }

/* Mini History inside Live Card */
.mini-hist { border-top: 1px solid #1a1a1a; padding-top: 4px; margin-top: 6px; }
.mini-hist-row { display: flex; gap: 2px; margin-bottom: 2px; opacity: 0.3; }
.mini-dot { width: 5px; height: 5px; border-radius: 1px; }

/* Input Pad with Visual Feedback */
.numpad-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; }
.num-btn { height: 45px; background: #21262d; border: 1px solid var(--border); color: #fff; border-radius: 8px; font-size: 18px; font-weight: bold; transition: transform 0.1s; }
.num-btn:active { transform: scale(0.9); background: var(--blue); }

.table-wrap { overflow-y: auto; max-height: 150px; background: #000; border-radius: 8px; }
table { width: 100%; border-collapse: collapse; font-size: 9px; }
td { padding: 8px 4px; border-bottom: 1px solid #222; text-align: center; }

#copyModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; padding: 20px; }
.modal-content { background: var(--card); padding: 15px; border-radius: 15px; border: 1px solid var(--gold); max-width: 380px; margin: auto; margin-top: 40px; }
textarea { width: 100%; height: 180px; background: #000; color: #0f0; margin: 10px 0; padding: 8px; box-sizing: border-box; font-family: monospace; }
</style>
</head>
<body>

<div class="container">
    <div class="panel" style="text-align: center; background: #000; border: 2px solid var(--gold); border-radius: 15px; padding: 12px;">
        <h4 style="border:none; justify-content: center; color:#444;">CORE ENGINE</h4>
        <div id="predDisplay" style="font-size: 45px; font-weight: bold; color: var(--blue); margin: 5px 0;">-</div>
        <div id="statusLabel" style="font-size:10px; color:#666; margin-bottom:8px;">READY</div>
        <div class="step-grid" style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 4px;">
            <script>for(let i=0;i<8;i++) document.write('<div class="step-box" style="height:28px; border:1px solid #444; border-radius:5px; display:flex; align-items:center; justify-content:center; font-size:10px; background:#222;" id="step-'+i+'">'+(i+1)+'</div>');</script>
        </div>
    </div>

    <div class="panel">
        <h4 style="color:var(--gold);">LIVE TRACKING</h4>
        <div id="liveMonitor" class="live-grid"></div>
    </div>

    <div class="panel">
        <div style="display:flex; justify-content:space-between; margin-bottom:6px;">
            <span style="font-size:10px; color:var(--gold); font-weight:bold;">INPUT</span>
            <div style="display:flex; gap:5px;">
                <button onclick="undoInput()" style="background:#30363d; color:var(--gold); border:none; padding:4px 10px; border-radius:5px; font-size:10px; font-weight:bold;">UNDO</button>
                <button onclick="resetData()" style="background:var(--red); color:white; border:none; padding:4px 10px; border-radius:5px; font-size:10px; font-weight:bold;">RESET</button>
            </div>
        </div>
        <div class="numpad-grid">
            <script>for(let i=0;i<=9;i++) document.write(`<button class="num-btn" onclick="handleInput(${i})">${i}</button>`);</script>
        </div>
    </div>

    <div class="panel">
        <h4><span>HISTORY</span> <button onclick="openCopyModal()" style="background:var(--green); border:none; color:white; padding:4px 10px; border-radius:5px; font-size:10px;">COPY</button></h4>
        <div class="table-wrap"><table><tbody id="historyBody"></tbody></table></div>
    </div>
</div>

<div id="copyModal"><div class="modal-content">
    <h4 style="justify-content:center; border:none;">EXPORT LOGS</h4>
    <textarea id="copyArea" readonly></textarea>
    <button onclick="doClipboardCopy()" style="width:100%; padding:10px; background:var(--green); border:none; color:white; border-radius:5px;">COPY CLIPBOARD</button>
    <button onclick="document.getElementById('copyModal').style.display='none'" style="width:100%; padding:10px; background:#444; border:none; color:white; border-radius:5px; margin-top:5px;">CLOSE</button>
</div></div>

<script>
// Patterns LOCKED (A:2 Fix)
const myPatterns = {
    even: { 0:"BBBSSBBB", 1:"SBSSBBBB", 2:"BBBSSSSB", 3:"SBBBBSSB", 4:"BBBBSSBB", 5:"BBBSSSBB", 6:"BBBSSSBB", 7:"SBBSSBBS", 8:"BBBSSBBB", 9:"BBBSSBBB" },
    odd: { 0:"SBBSSBSS", 1:"BBBSSBBS", 2:"BBBBSSSB", 3:"BBBBSSBS", 4:"BBBBSSBS", 5:"BSBBSSBS", 6:"BBBSSBBS", 7:"BBBSSBBB", 8:"BBBSSBBB", 9:"BBBBSSBB" }
};

let rawInputs = JSON.parse(localStorage.getItem('rawInputs')) || [];
let activeTracks = JSON.parse(localStorage.getItem('activeTracks')) || [];
let historyLog = JSON.parse(localStorage.getItem('historyLog')) || [];
let lockedTrackId = localStorage.getItem('lockedTrackId') || null;

function saveData() {
    localStorage.setItem('rawInputs', JSON.stringify(rawInputs));
    localStorage.setItem('activeTracks', JSON.stringify(activeTracks));
    localStorage.setItem('historyLog', JSON.stringify(historyLog));
    if (lockedTrackId) localStorage.setItem('lockedTrackId', lockedTrackId);
    else localStorage.removeItem('lockedTrackId');
}

function resetData() { if(confirm("Clear all data?")) { localStorage.clear(); location.reload(); } }

function undoInput() {
    if (rawInputs.length === 0) return;
    rawInputs.pop();
    if (activeTracks.length > 0) activeTracks.pop();
    activeTracks.forEach(t => t.results.pop());
    lockedTrackId = activeTracks.length > 0 ? activeTracks[activeTracks.length-1].id : null;
    saveData(); renderUI();
}

function handleInput(num) {
    const bs = num >= 5 ? "B" : "S";
    activeTracks.forEach(t => { if (t.results.length < 8) t.results.push(bs === t.pattern[t.results.length] ? "✅" : "❌"); });

    if (lockedTrackId) {
        let locked = activeTracks.find(t => t.id == lockedTrackId);
        if (locked && (locked.results[locked.results.length-1] === "✅" || locked.results.length === 8)) lockedTrackId = null;
    }

    if (rawInputs.length > 0) {
        const type = (rawInputs[rawInputs.length-1] % 2 === 0) ? 'even' : 'odd';
        let newT = { id: Date.now()+Math.random(), digit: num, type: type, pattern: myPatterns[type][num], results: [] };
        activeTracks.push(newT);
        if (!lockedTrackId) lockedTrackId = newT.id;
    }
    rawInputs.push(num);
    for (let i = activeTracks.length - 1; i >= 0; i--) {
        if (activeTracks[i].results.length === 8) historyLog.unshift(activeTracks.splice(i, 1)[0]);
    }
    saveData(); renderUI();
}

function renderUI() {
    const locked = activeTracks.find(t => t.id == lockedTrackId);
    const stepIdx = locked ? locked.results.length : -1;
    document.getElementById('predDisplay').innerText = locked ? locked.pattern[stepIdx] : "-";
    document.getElementById('statusLabel').innerText = locked ? `ID:${locked.type[0].toUpperCase()}${locked.digit} | POS:${stepIdx+1}` : "WAITING";
    
    for(let i=0; i<8; i++) {
        let el = document.getElementById(`step-${i}`);
        let res = locked ? locked.results[i] : "";
        el.style.background = res==='✅'?'var(--green)':(res==='❌'?'var(--red)':'#222');
        el.style.border = (i===stepIdx) ? '1.5px solid var(--gold)' : '1px solid #444';
        el.innerText = res || (i+1);
    }

    document.getElementById('liveMonitor').innerHTML = activeTracks.map(t => {
        const isTriggered = !t.results.includes("✅") && t.results.length >= 3;
        const sHist = historyLog.filter(h => h.type === t.type && h.digit === t.digit).slice(0, 2);

        return `
        <div class="live-card ${isTriggered ? 'signal-on' : ''}">
            <div class="live-info">
                <span style="color:${isTriggered ? 'var(--red)' : '#888'}">${t.type[0].toUpperCase()}:${t.digit} (P:${t.results.length+1})</span>
                <span style="color:var(--gold); font-weight:900;">${t.pattern[t.results.length] || '-'}</span>
            </div>
            <div class="live-dots">
                ${t.pattern.split('').map((p, i) => `
                    <div class="dot-col">
                        <div class="dot" style="background:${t.results[i] === '✅' ? 'var(--green)' : (t.results[i] === '❌' ? 'var(--red)' : '#222')}"></div>
                        <div class="pos-num">${i+1}</div>
                    </div>
                `).join('')}
            </div>
            <div class="mini-hist">
                ${sHist.map(h => `<div class="mini-hist-row">${h.results.map(r => `<div class="mini-dot" style="background:${r==='✅'?'var(--green)':'var(--red)'}"></div>`).join('')}</div>`).join('')}
            </div>
        </div>`;
    }).join('');

    document.getElementById('historyBody').innerHTML = historyLog.slice(0,20).map(h => `
        <tr>
            <td style="color:var(--gold); font-weight:bold;">${h.type[0].toUpperCase()}:${h.digit}</td>
            <td style="letter-spacing:1px; color:#777;">${h.results.join('')}</td>
            <td style="color:${h.results.includes('✅')?'var(--green)':'var(--red)'};">${h.results.includes('✅')?'WIN':'LOSS'}</td>
        </tr>`).join('');
}

function openCopyModal() { document.getElementById('copyModal').style.display = 'block'; generateCopy('normal'); }
function generateCopy(mode) {
    let text = "ID\tRECORD\tSTAT\n";
    historyLog.forEach(h => text += `${h.type[0].toUpperCase()}:${h.digit}\t${h.results.join('')}\t${h.results.includes('✅')?'W':'L'}\n`);
    document.getElementById('copyArea').value = text;
}
function doClipboardCopy() { document.getElementById('copyArea').select(); document.execCommand('copy'); alert("Copied!"); }
renderUI();
</script>
</body>
</html>
