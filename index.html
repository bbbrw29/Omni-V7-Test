<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OMNI V7 Pro - iPad Stable</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --border: #30363d; --text: #c9d1d9; --blue: #58a6ff; --green: #238636; --red: #f85149; --gold: #d29922; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 10px; margin: 0; -webkit-user-select: none; user-select: none; }
        .container { max-width: 480px; margin: auto; }
        
        .master-box { background: #1c2128; border: 2px solid var(--border); border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 10px; }
        .master-val { font-size: 48px; font-weight: 900; margin: 0; }
        
        /* iPad နှိပ်ရလွယ်စေရန် Keypad ကို အထူးပြင်ဆင်ခြင်း */
        .keypad { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 12px; }
        .key { 
            background: #21262d; border: 1px solid var(--border); color: white; 
            padding: 25px 0; border-radius: 12px; font-size: 26px; font-weight: bold; 
            text-align: center; cursor: pointer; touch-action: none;
            -webkit-tap-highlight-color: transparent;
        }
        .key:active { background: var(--blue); transform: scale(0.9); }

        .action-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .btn { flex: 1; padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; color: white; }

        .abc-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; background: var(--card); border: 1px solid var(--border); border-radius: 10px; overflow: hidden; }
        .abc-table td { padding: 12px; text-align: center; border: 1px solid var(--border); font-weight: bold; }
        .label { color: #8b949e; background: #1c2128; font-size: 13px; }

        .history-wrapper { border-radius: 10px; border: 1px solid var(--border); background: var(--card); max-height: 300px; overflow-y: auto; }
        table.main-table { width: 100%; border-collapse: collapse; }
        .main-table th { background: #21262d; padding: 12px; font-size: 11px; position: sticky; top: 0; }
        .main-table td { padding: 12px; border-bottom: 1px solid var(--border); text-align: center; font-size: 14px; }
        
        .B-text { color: var(--blue); } .S-text { color: var(--green); }
    </style>
</head>
<body>

<div class="container">
    <div class="master-box">
        <div id="mVal" class="master-val">-</div>
        <div id="mStatus" style="font-size: 12px; color: #8b949e;">READY</div>
    </div>

    <div class="keypad">
        <div class="key" onpointerdown="pressKey(1)">1</div>
        <div class="key" onpointerdown="pressKey(2)">2</div>
        <div class="key" onpointerdown="pressKey(3)">3</div>
        <div class="key" onpointerdown="pressKey(4)">4</div>
        <div class="key" onpointerdown="pressKey(5)">5</div>
        <div class="key" onpointerdown="pressKey(6)">6</div>
        <div class="key" onpointerdown="pressKey(7)">7</div>
        <div class="key" onpointerdown="pressKey(8)">8</div>
        <div class="key" onpointerdown="pressKey(9)">9</div>
        <div class="key" onpointerdown="pressKey(0)">0</div>
    </div>

    <div class="action-row">
        <button class="btn" style="background:var(--red)" onpointerdown="undo()">UNDO</button>
        <button class="btn" style="background:#30363d" onclick="resetApp()">RESET</button>
    </div>

    <table class="abc-table">
        <tbody>
            <tr><td class="label">Sum(A)</td><td id="a5">-</td><td id="a7">-</td><td id="a10">-</td></tr>
            <tr><td class="label">Mat(B)</td><td id="b5">-</td><td id="b7">-</td><td id="b10">-</td></tr>
            <tr><td class="label">Tre(C)</td><td id="c5">-</td><td id="c7">-</td><td id="c10">-</td></tr>
        </tbody>
    </table>

    <div class="history-wrapper">
        <table class="main-table">
            <thead><tr><th>ID</th><th>RESULT</th><th>PRED</th><th>ABC</th></tr></thead>
            <tbody id="histBody"></tbody>
        </table>
    </div>
</div>

<script>
    let digits = JSON.parse(localStorage.getItem('omni_v7_ipad_stable')) || [];
    let history = [];

    window.onload = () => analyze();

    function pressKey(n) { digits.push(n); update(); }
    function undo() { digits.pop(); update(); }
    function update() { localStorage.setItem('omni_v7_ipad_stable', JSON.stringify(digits)); analyze(); }

    const getA = (w, d) => d.length < w ? "-" : (d.slice(-w).reduce((a,b)=>a+b,0) % 2 === 0 ? "S" : "B");
    const getB = (w, d) => d.length < w ? "-" : ((d.slice(-w).reduce((a,b)=>a+b,0) % 10) % 2 === 0 ? "S" : "B");
    const getC = (w, d) => {
        if(d.length < w) return "-";
        let win = d.slice(-w);
        return (win[win.length-1] - win[0]) >= 0 ? "B" : "S";
    };

    function analyze() {
        history = []; let temp = []; let lp = { final: "-" };
        digits.forEach((v) => {
            const act = v >= 5 ? "B" : "S";
            if (lp.final !== "-") {
                const ck = (p, a) => p === a ? "✅" : "❌";
                history.unshift({
                    id: history.length + 1,
                    res: `<b>${v}(${act})</b>`,
                    pred: `${lp.final}${ck(lp.final, act)}`,
                    abc: `${ck(lp.a5, act)}|${ck(lp.b5, act)}|${ck(lp.c5, act)}`
                });
            }
            temp.push(v);
            if (temp.length >= 8) {
                lp = { 
                    a5: getA(5,temp), a7: getA(7,temp), a10: getA(10,temp),
                    b5: getB(5,temp), b7: getB(7,temp), b10: getB(10,temp),
                    c5: getC(5,temp), c7: getC(7,temp), c10: getC(10,temp)
                };
                lp.final = (lp.a5 === "B" || lp.b5 === "B") ? "B" : "S";
            }
        });
        render(lp);
    }

    function render(lp) {
        if (digits.length < 8) {
            document.getElementById('mVal').innerText = "-";
            document.getElementById('mStatus').innerText = `${8-digits.length} digits needed`;
        } else {
            document.getElementById('mVal').innerText = lp.final === "B" ? "BIG" : "SMALL";
            document.getElementById('mVal').className = "master-val " + lp.final + "-text";
            ['a5','a7','a10','b5','b7','b10','c5','c7','c10'].forEach(id => {
                document.getElementById(id).innerText = lp[id];
                document.getElementById(id).className = lp[id] + "-text";
            });
        }
        document.getElementById('histBody').innerHTML = history.map(h => `<tr><td>${h.id}</td><td>${h.res}</td><td>${h.pred}</td><td>${h.abc}</td></tr>`).join('');
    }

    function resetApp() { if(confirm("Reset?")) { digits=[]; update(); location.reload(); } }
</script>
</body>
</html>
